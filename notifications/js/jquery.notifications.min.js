(function($){$.fn.extend({notifications:function(options){var defaults={effect:"slide",effectOptions:{direction:"down",easing:"easeInQuad"},effectDuration:500,hideDelay:1500,actionsBackgroundColor:"#DDDDDD",actionsTextColor:"#000000",messageBackgroundColor:"#FFFF77",messageTextColor:"#000000",messageDuration:5E3,ajaxqueues:[]};var opts=defaults;if(options)opts=$.extend(defaults,options);insertDOM($(this));$("#notificationsContainer").css("background-color",opts.actionsBackgroundColor);$("#notificationsContainer").css("color",
opts.actionsTextColor);$("#notificationMessageContainer").css("background-color",opts.messageBackgroundColor);$("#notificationMessageContainer").css("color",opts.messageTextColor);var fixedDiv;if($.browser.mozilla)fixedDiv="#notificationsFixedArea";else fixedDiv="#notificationsContainer";$(fixedDiv).hide();$("#notificationMessageContainer").hide();$("#notificationsNoActions").hide();if(opts.ajaxqueues.length>0)setupAjaxQueues();var active=[];var waiting=[];var messages=[];var isVisible=false;var isOnlyMessageVisible=
false;var isMessageVisible=false;var isMessageDisplaying=false;var ajaxqueueActive=new Array(opts.ajaxqueues.length);var ajaxqueueWaiting=new Array(opts.ajaxqueues.length);this.active=function(){return active};this.waiting=function(){return waiting};this.setActive=function(actionArray){active=actionArray;updateUI()};this.setWaiting=function(actionArray){waiting=actionArray;updateUI()};this.addActive=function(actionName){active.push(actionName);updateUI()};this.addWaiting=function(actionName){waiting.push(actionName);
updateUI()};this.clearActive=function(){active=[];updateUI()};this.clearWaiting=function(){waiting=[];updateUI()};this.clearAll=function(){active=[];waiting=[];updateUI()};this.addMessage=function(html){messages.push(html);updateUI()};this.nextMessage=function(){isMessageDisplaying=false;updateUI()};this.clearAllMessages=function(){messages=[];updateUI()};this.addAjaxQueue=function(newQueue){opts.ajaxqueues.push(newQueue);setupAjaxQueues()};function insertDOM(domElement){var html='<div id="notificationsFixedArea">'+
'<div id="notificationMessageContainer">'+'<div class="notificationsLine"></div>'+'<div id="notificationMessage"></div>'+"</div>"+'<div id="notificationsContainer">'+'<div class="notificationsLine"></div>'+'<div id="notificationsInner">'+'<div id="notificationsActionsCount">'+'<span id="notificationsActiveImage"></span> '+'<span id="notificationsActiveCount">0</span> '+"actions active / "+'<span id="notificationsWaitingCount">0</span> actions waiting'+"</div>"+'<span id="notificationsNoActions">No active or waiting actions</span>'+
"</div>"+"</div>"+"</div>";domElement.html(html)}function setupAjaxQueues(){function updateActiveWaiting(queue){return function(){setAjaxQueueActive(queue,queue.active());setAjaxQueueWaiting(queue,queue.waiting())}}for(var index=0;index<opts.ajaxqueues.length;index++){var curriedUpdate=updateActiveWaiting(opts.ajaxqueues[index]);opts.ajaxqueues[index].setPreAction(curriedUpdate);opts.ajaxqueues[index].setPostAddAction(curriedUpdate);opts.ajaxqueues[index].setPostAction(curriedUpdate)}}function setAjaxQueueActive(queueObject,
active){if(!ajaxqueueActive[queueObject.id()])ajaxqueueActive[queueObject.id()]=new Array(1);ajaxqueueActive[queueObject.id()][0]=active;assignQueueArrays()}function setAjaxQueueWaiting(queueObject,waiting){if(!ajaxqueueWaiting[queueObject.id()])ajaxqueueWaiting[queueObject.id()]=new Array(1);ajaxqueueWaiting[queueObject.id()][0]=waiting;assignQueueArrays()}function assignQueueArrays(){active=[];waiting=[];for(var index=0;index<opts.ajaxqueues.length;index++){var queueObject=opts.ajaxqueues[index];
if(ajaxqueueActive[queueObject.id()])active=active.concat(ajaxqueueActive[queueObject.id()][0]);if(ajaxqueueWaiting[queueObject.id()])waiting=waiting.concat(ajaxqueueWaiting[queueObject.id()][0])}updateUI()}function isAnyActions(){return active.length>0||waiting.length}function isAnyMessages(){return messages.length>0}function updateUI(){showNotifications();setCounts();showMessage();setNextMessage();hideMessage();hideNotifications()}function showNotifications(){if(isAnyActions()||isAnyMessages()){if(!isVisible&&
!isAnyActions()&&isAnyMessages()){$("#notificationsContainer").hide();$("#notificationsFixedArea").show();isOnlyMessageVisible=true}else if(isVisible&&isOnlyMessageVisible&&isAnyActions()){$("#notificationsContainer").show();isOnlyMessageVisible=false}else if(!isVisible){$("#notificationsContainer").show();$(fixedDiv).show(opts.effect,opts.effectOptions,opts.effectDuration,function(){});isOnlyMessageVisible=false}isVisible=true}}function setCounts(){if(isVisible&&isAnyActions()){$("#notificationsActiveCount").html(active.length);
$("#notificationsWaitingCount").html(waiting.length);$("#notificationsActionsCount").show();$("#notificationsNoActions").hide()}else if(isVisible){$("#notificationsActionsCount").hide();$("#notificationsNoActions").show()}}function showMessage(){function showMessageHelper(){$("#notificationMessageContainer").fadeIn(500,function(){});isVisible=true}if(!isMessageVisible&&isAnyMessages())if(!isAnyActions())setTimeout(showMessageHelper,opts.effectDuration);else showMessageHelper()}function setNextMessage(){if(isAnyMessages()&&
!isMessageDisplaying){var currentMessage=messages.shift();$("#notificationMessage").html(currentMessage);isMessageDisplaying=true;$("#notificationMessage").fadeIn(300,function(){if(opts.messageDuration>0)setTimeout(function(){$("#notificationMessage").fadeOut(300,function(){isMessageDisplaying=false;setNextMessage()})},opts.messageDuration)})}else if(!isAnyMessages())hideMessage()}function hideMessage(){if(isVisible&&!isMessageDisplaying&&!isAnyMessages())$("#notificationMessageContainer").fadeOut(500,
function(){$("#notificationMessage").html("");hideNotifications()})}function hideNotifications(){if(isVisible&&!isAnyActions()&&!isAnyMessages()&&!isOnlyMessageVisible&&$("#notificationMessage").html()===""){setTimeout(function(){$(fixedDiv).hide(opts.effect,opts.effectOptions,opts.effectDuration,function(){})},opts.hideDelay);isVisible=false}}return this}})})(jQuery);
