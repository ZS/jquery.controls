(function($){$.fn.extend({infinitescroller:function(options){var defaults={url:"",scrollContainer:null,initialPage:1,totalPageCount:null,previousButton:null,previousLoadingGraphic:null,nextLoadingGraphic:null,triggerAtBottom:30,triggerAtTop:5,scrollTopOffset:0,ajaxData:{},onLoadCallback:null};var opts=defaults;if(options)opts=$.extend(defaults,options);var listContainer=$(this);var scrollContainer=opts.scrollContainer;var hasTriggered=false;var lastListHeight=listContainer.height();if(opts.previousButton)opts.previousButton.click(function(event){opts.previousButton.hide();
loadPreviousPage();return false});var minPageLoaded;var maxPageLoaded;this.loadPage=function(page){if(opts.previousButton)opts.previousButton.hide();listContainer.html("");minPageLoaded=page;maxPageLoaded=page;var data=opts.ajaxData;data.page=page;ajaxCall(replaceData,null,null,opts.previousLoadingGraphic,data)};if(opts.initialPage>0)this.loadPage(opts.initialPage);this.setTotalPageCount=function(count){opts.totalPageCount=count};scrollContainer.scroll(function(event){scrollCheck()});function getPreviousPage(){return minPageLoaded-
1}function getNextPage(){return maxPageLoaded+1}function decrementPage(){minPageLoaded--;var newScrollPosition=listContainer.height()-lastListHeight;scrollContainer.scrollTop(newScrollPosition+opts.scrollTopOffset)}function incrementPage(){maxPageLoaded++}function isNoScrollbar(){return listContainer.height()<scrollContainer.height()}function loadPreviousPage(){lastListHeight=listContainer.height();ajaxCall(prependData,getPreviousPage,decrementPage,opts.previousLoadingGraphic,null)}function loadNextPage(){ajaxCall(appendData,
getNextPage,incrementPage,opts.nextLoadingGraphic,null)}function scrollCheck(){if(isNoScrollbar()){if(!opts.previousButton)ajaxCall(prependData,getPreviousPage,decrementPage,opts.previousLoadingGraphic,null)}else if(getBottomSpacing()-scrollContainer.scrollTop()<opts.triggerAtBottom)loadNextPage();else if(scrollContainer.scrollTop()<opts.triggerAtTop)if(!opts.previousButton)loadPreviousPage()}function getBottomSpacing(){return listContainer.height()-scrollContainer.height()}function replaceData(data){listContainer.html(data);
if(isNoScrollbar())scrollCheck();else scrollContainer.scrollTop(opts.scrollTopOffset)}function prependData(data){listContainer.prepend(data)}function appendData(data){listContainer.append(data)}function ajaxCall(changeFunction,nextPageFunction,pageChangeFunction,loadingGraphic,otherData){var data;if(otherData)data=otherData;else{data=opts.ajaxData;data.page=nextPageFunction()}if(data.page>0&&data.page<=opts.totalPageCount&&!hasTriggered){hasTriggered=true;if(loadingGraphic)loadingGraphic.show();$.ajax({type:"POST",
url:opts.url,data:data,success:function(response){hasTriggered=false;if(loadingGraphic)loadingGraphic.hide();changeFunction(response);if(pageChangeFunction)pageChangeFunction();if(opts.previousButton&&data.page>1)opts.previousButton.show();else if(opts.previousButton)opts.previousButton.hide();if(opts.onLoadCallback)opts.onLoadCallback()}})}}return this}})})(jQuery);